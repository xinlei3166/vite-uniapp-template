import{d as e,b as r,X as s,w as t,f as o,h as l,i as a,j as i,l as n,n as u,u as c,k as d,D as p,a as m,H as f,Y as v,s as y,t as h,q as _,v as b}from"./index-ff6f2602.js";import{a as g,N as P}from"./cell.94a1bf23.js";import{c as A,l as j,a as w,g as q,n as E,o as x,q as $,P as k,r as S,s as I,m as O,t as M,p as C}from"./icon.bcb121d6.js";import{u as H}from"./useProvide.3e7371d1.js";import{_ as T}from"./plugin-vueexport-helper.1b428a4d.js";import{u as V}from"./useInject.ea573975.js";const W=Symbol("Form"),G={...A,modelValue:j({}),rules:j({}),labelPosition:w("left"),starPosition:w("left")},L={validate:e=>e instanceof Object},D=`${k}-form`,F=e({name:D,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),N=T(e({...F,props:G,emits:L,setup(e,{expose:v,emit:y}){const h=e;v({reset:function(){A()},submit:function(){return k(),!1},validate:k});const _=r((()=>m({}))),{internalChildren:b}=H(W,"nut-form-item")({props:h,formErrorTip:_});s("formErrorTip",_);const P=r((()=>q(h,D)));function A(){Object.keys(_.value).forEach((e=>{_.value[e]=""}))}function j(e){let r=[];return e.forEach((e=>{var s,t,o,l;let a=e.type;a=a.name||a,"nut-form-item"===a||(null==a?void 0:a.toString().endsWith("form-item"))?r.push({prop:null==(s=e.props)?void 0:s.prop,rules:(null==(t=e.props)?void 0:t.rules)||[]}):Array.isArray(e.children)&&(null==(o=e.children)?void 0:o.length)?r=r.concat(j(e.children)):E(e.children)&&Object.keys(e.children)?(null==(l=e.children)?void 0:l.default)&&(e.children=e.children.default(),r=r.concat(j(e.children))):Array.isArray(e)&&(r=r.concat(j(e)))})),r}function w(e){e.message&&y("validate",e),_.value[e.prop]=e.message}function k(e=""){return new Promise(((r,s)=>{try{const s=j(null==b?void 0:b.map((e=>e.vnode))).map((r=>e&&e!==r.prop?Promise.resolve(!0):async function(e){const{rules:r,prop:s}=e,t=e=>new Promise(((r,s)=>{try{w(e),r(e)}catch(t){s(t)}})),o=x(h.modelValue,s||"");w({prop:s,message:""});const l=h.rules||{},a=[...(null==l?void 0:l[s])||[],...r];for(;a.length;){const e=a.shift(),{validator:r,...l}=e,{required:n,regex:u,message:c}=l,d={prop:s,message:c};if(n&&!o&&0!==o)return t(d);if(u&&!u.test(String(o)))return t(d);if(r){const e=r(o,l);if($(e))try{if(!1===await e)return t(d)}catch(i){return t({prop:s,message:i})}else if(!e)return t(d)}}return Promise.resolve(!0)}(r)));Promise.all(s).then((e=>{const s={valid:!0,errors:[]};(e=e.filter((e=>!0!==e))).length&&(s.valid=!1,s.errors=e),r(s)}))}catch(t){s(t)}}))}return t((()=>h.modelValue),(()=>{A()}),{immediate:!0}),(e,r)=>{const s=f;return o(),l(s,{class:u(c(P)),style:d(e.customStyle),action:"#",onSubmit:r[0]||(r[0]=p((()=>!1),["prevent"]))},{default:a((()=>[i(g,null,{default:a((()=>[n(e.$slots,"default",{},void 0,!0)])),_:3})])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-78bc3b52"]]),X={...A,required:S,prop:w(""),label:w(""),rules:I([]),labelWidth:O(""),labelAlign:w("left"),bodyAlign:w("left"),errorMessageAlign:w("left"),showErrorLine:M,showErrorMessage:M,labelPosition:w(void 0),starPosition:w(void 0)},Y=`${k}-form-item`,z=e({name:Y,inheritAttrs:!1,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),B=T(e({...z,props:X,setup(e){var t;const p=e,m=v(),f=V(W);s("form",{props:p});const g=r((()=>{var e,r;if(!1===p.required)return!1;const s=null==(r=null==(e=f.parent)?void 0:e.props)?void 0:r.rules;let t=!1;for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&o===p.prop&&Array.isArray(s[o])&&(t=s[o].some((e=>e.required)));return p.required||p.rules.some((e=>e.required))||t})),A=r((()=>{var e;const r=null==(e=f.parent)?void 0:e.props.labelPosition;return`nut-form-item__${p.labelPosition?p.labelPosition:r}`})),j=r((()=>{var e;const r=null==(e=f.parent)?void 0:e.props.starPosition;return`nut-form-item__star-${p.starPosition?p.starPosition:r}`})),w=r((()=>q(p,Y))),E=r((()=>({width:C(p.labelWidth),textAlign:p.labelAlign}))),x=r((()=>({textAlign:p.bodyAlign}))),$=(null==(t=f.parent)?void 0:t.formErrorTip)||{},k=r((()=>({textAlign:p.errorMessageAlign})));return(e,r)=>{const s=b;return o(),l(P,{"custom-class":[{error:c($)[e.prop],line:e.showErrorLine},c(w),c(A)],"custom-style":e.customStyle},{default:a((()=>{return[e.label||(r="label",m[r])?(o(),l(s,{key:0,class:u(["nut-cell__title nut-form-item__label",{required:c(g),[c(j)]:c(j)}]),style:d(c(E))},{default:a((()=>[n(e.$slots,"label",{},(()=>[y(h(e.label),1)]),!0)])),_:3},8,["style","class"])):_("v-if",!0),i(s,{class:"nut-cell__value nut-form-item__body"},{default:a((()=>[i(s,{class:"nut-form-item__body__slots",style:d(c(x))},{default:a((()=>[n(e.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),c($)[e.prop]&&e.showErrorMessage?(o(),l(s,{key:0,class:"nut-form-item__body__tips",style:d(c(k))},{default:a((()=>[y(h(c($)[e.prop]),1)])),_:1},8,["style"])):_("v-if",!0)])),_:3})];var r})),_:3},8,["custom-class","custom-style"])}}}),[["__scopeId","data-v-55da57d1"]]);export{B as _,N as a};
